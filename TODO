add checks for malloc
refactor code to use searchinfo
filenames without _
