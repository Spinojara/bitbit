/* bitbit, a bitboard based chess engine written in c.
 * Copyright (C) 2022 Isak Ellmer
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

#include "evaluate.h"

#include <string.h>

mevalue psqtable[2][7][64];

//mevalue piece_value[6] = { S( 90, 125), S( 420, 351), S( 450, 352), S( 576, 597), S(1237, 1077), };
mevalue piece_value[6] = { S(  93, 156), S( 432, 491), S( 455, 526), S( 588, 859), S(1360,1553), };

/* from white's perspective, files a to d on a regular board */
mevalue white_psqtable[6][64] = {
	{ /* pawn */
		S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
		S( 73, 94), S(102, 93), S( 15, 84), S(121, 36), S( 17, 81), S( -7, 78), S( 43,130), S(-17,101),
		S( 24,  6), S(-24,-14), S( -1,-22), S( 10,-58), S( 15,-66), S(-12,-18), S( 23,-18), S( 33, -1),
		S(-10, 11), S(-16, -6), S(-24,-11), S( -8,-37), S(-13,-23), S(-16, -1), S( -8, -6), S(  7,  0),
		S(-18,  1), S(-16,-10), S(  2, -9), S(  1,-16), S( -4, -6), S( -2,  2), S( -8, -7), S(-12, -8),
		S(-27,-10), S(-20,-19), S(-14,-12), S( -5,-11), S(  2, -9), S(-11,  0), S( 26,-20), S( -8,-23),
		S(-30,  3), S(-10,-19), S(-10, -5), S( -4,-30), S(-14,-15), S( 29, -5), S( 27,-19), S( -3,-22),
		S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
	}, { /* knight */
		S(-194, -7), S(-46,  6), S(-81,  4), S(-72, -5),
		S(-16,-23), S(-29,  6), S( 30,-16), S( 49, -6),
		S(  1,-23), S( 22, -3), S( 47,  1), S( 62, -6),
		S( 24,-13), S( -9, -3), S(  9, 13), S( -4, 19),
		S( -3, -4), S(-20, -1), S( -1,  9), S( -9, 17),
		S(-21,-19), S( -2,-23), S(-10,-22), S( -3,  2),
		S(-18,-14), S(  4,  3), S(-11, -8), S( -5,-11),
		S(-133,-10), S(-15,-19), S( -9,-19), S(-20,  3),
	}, { /* bishop */
		S( -7,  5), S(-44,  5), S(-120,-15), S(-36,-14),
		S(-34, -9), S(-29,-10), S(-11, -9), S(-29,-11),
		S( -1,-30), S( 16,-10), S( 17,  1), S( 33,-15),
		S(-11,-26), S(  2, -7), S( -1,-11), S( 18,  2),
		S(  6,-28), S(-29,-11), S(-10,-11), S( -1, -3),
		S(  4,-14), S(  8,-17), S(  2, -8), S( -2, -6),
		S( 26,-34), S( 20,-31), S( 13,-23), S( -7,-16),
		S(-21,  4), S(  4,-23), S(-22,-12), S(-10,-23),
	}, { /* rook */
		S( 49, -9), S( 18,  2), S( 13,  5), S(-11,  8),
		S(  7,  3), S( -6, 13), S( 12,  8), S( 43, -2),
		S(-31,  3), S( 17, -8), S( 39, -9), S( 37, -6),
		S( -6, -4), S(-12,  0), S( 12, -6), S( 14, -4),
		S(-28,-10), S(-15, -6), S(-37, -5), S(-23,-12),
		S(-44,-36), S(-18,-32), S(-37,-26), S(-24,-38),
		S(-63,-27), S(-21,-50), S(-18,-41), S(-12,-41),
		S( -6,-38), S(-21,-26), S( -7,-33), S(  2,-35),
	}, { /* queen */
		S(-34,  6), S( 25, -9), S( 15,-31), S(-18,-13),
		S(-19, -1), S(-51, 35), S(-21,  7), S(-29, 44),
		S( 17,-39), S( -1, -6), S(  9, 17), S( -5, 33),
		S(-14, -2), S(-17, 50), S(-18,  7), S(-26, 37),
		S(  3,-34), S( -8, 13), S(-17, 20), S(-20, 34),
		S(  4,-55), S( 11,-36), S( -7,  0), S(  3,-28),
		S( -2,-85), S( 25,-84), S( 19,-76), S(  9,-46),
		S(  5,-98), S(-23,-82), S(  2,-104), S( -2,-71),
	}, { /* king */
		S(  2,-195), S( 32,-12), S( 77, -1), S(-47, -2),
		S(-22, -8), S(-153, 90), S(-65, 40), S(-38, 39),
		S(-79, 25), S(-115, 71), S(-83, 71), S(-38, 39),
		S(  0, -5), S(-97, 55), S(-34, 47), S(-57, 39),
		S(-64,-21), S(-59, 18), S( -8, 14), S( 35, 15),
		S(  7,-48), S(-25, -8), S(-14, -4), S( 27, -5),
		S( 12,-55), S( -6,-27), S( 10,-26), S(  3,-27),
		S( 29,-89), S( 36,-63), S( 22,-68), S( 49,-82),
	}
};

mevalue mobility_bonus[4][28] = {
        {
                S(-89,-95), S(-25,-92), S(-12,-45), S( -8,-12), S(  1,  2), S(  8, 12), S( 15, 17), S( 21, 21), S( 27, 15),
        }, {
                S(-52,-102), S(-16,-94), S( -5,-29), S(  0, -1), S(  8, 14), S( 12, 29), S( 18, 35), S( 18, 42), S( 24, 41),
                S( 23, 44), S( 19, 48), S( 27, 46), S( 23, 41), S( 29, 44),
        }, {
                S(-147,-169), S(-27,-52), S(-15,-43), S( -5,-11), S( -3,-11), S( -2,  5), S(-13, 14), S( -3, 17), S(  1, 22),
                S(  7, 28), S( 16, 33), S( 22, 33), S( 16, 38), S( 19, 36), S( 37, 23),
        }, {
                S( -2,-14), S(-85,-68), S( -6,-110), S(  4,-132), S( 16,-92), S( 16,-79), S( 13,-50), S( 10,-26), S( 14,-21),
                S( 13,  3), S( 14, 23), S( 14, 35), S( 14, 44), S( 16, 50), S( 15, 61), S( 14, 66), S( 17, 55), S( 12, 69),
                S( 11, 62), S( 23, 47), S( 22, 53), S( 36, 41), S( 18, 57), S( 51, 31), S( 66, 10), S( 69,  7), S( -6,-26),
                S( 72, 21),
        }
};

mevalue pawn_shelter[28] = {
        S( 11,-16), S( 25,-22), S( 44,-24), S( 14,-10), S(  4,  3), S( 13, 22), S(115, 27),
        S(-14,-11), S( 12,-14), S(  5,-27), S(-26,-12), S(-31,  6), S(-26, 17), S( -9,  8),
        S(-13,-11), S( 16,-12), S( -4, -5), S(-16,-10), S(  4,  1), S( 13, -8), S( 54, 16),
        S(-46,-16), S(-21,-12), S(-29,-15), S(-36, -4), S(-41,  5), S(-94, 13), S(-141, 10),
};

mevalue unblocked_storm[28] = {
        S(-31,-47), S(140,325), S( 13,208), S(-57, 57), S(-38, -8), S(-11,-38), S(-20,-31),
        S(-18,-33), S(130,313), S(-51,165), S(-57, 32), S(-44, -2), S(  7,-26), S(-12,-23),
        S(  0,-26), S(-73,135), S(-70, 89), S(-17, 28), S(-23, -1), S(  7,-18), S(  6,-24),
        S(-15,-16), S(-54,145), S(-62, 95), S(-34, 11), S( -9,-16), S(  8,-24), S( -7,-33),
};

mevalue blocked_storm[7] = {
        S(  0,  0), S(-54,-47), S( -3,-33), S( 11,-40), S(  9,-55), S(  5,-44), S(  4,  0),
};

void tables_init(void) {
	memset(psqtable, 0, sizeof(psqtable));
	for (int turn = 0; turn < 2; turn++) {
		for (int piece = pawn; piece <= king; piece++) {
			for (int square = 0; square < 64; square++) {
				int f = file_of(square);
				int r = rank_of(square);
				int factor = (piece == pawn) ? 8 : 4;
				if (f >= 4 && piece != pawn)
					f = 7 - f;
				if (turn == white)
					r = 7 - r;
				psqtable[turn][piece][square] = white_psqtable[piece - 1][factor * r + f] +
					piece_value[piece - 1];
			}
		}
	}
}
